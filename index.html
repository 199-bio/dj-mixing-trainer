<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DJ Mixing Trainer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <h1>DJ Mixing Trainer</h1>
      <div class="actions">
        <button id="helpBtn" title="Show help" aria-keyshortcuts="Alt+/">Help</button>
        <button id="startAudioBtn" title="Initialize audio" aria-keyshortcuts="Alt+A">Start Audio</button>
        <button id="startTutorialBtn" title="Start guided tutorial" aria-keyshortcuts="Alt+T">Start Tutorial</button>
        <button id="toggleVisual" title="Toggle non-interactive visual mode" aria-keyshortcuts="Alt+V">Visual Mode</button>
      </div>
    </header>

    <main class="layout">
      <section class="deck" data-deck="A">
        <h2>Deck A</h2>
        <div class="skin deck-skin" data-sdeck="A">
          <svg viewBox="0 0 360 260" class="skin-svg" aria-hidden="true">
            <!-- EQ knobs -->
            <g class="knob" data-role="eq-low" transform="translate(60,46)">
              <circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/>
              <text y="38" class="label">LOW</text>
            </g>
            <g class="knob" data-role="eq-mid" transform="translate(120,46)">
              <circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/>
              <text y="38" class="label">MID</text>
            </g>
            <g class="knob" data-role="eq-high" transform="translate(180,46)">
              <circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/>
              <text y="38" class="label">HI</text>
            </g>
            <!-- Filter & Gain -->
            <g class="knob" data-role="filter" transform="translate(240,46)">
              <circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/>
              <text y="38" class="label">FILTER</text>
            </g>
            <g class="knob" data-role="gain" transform="translate(300,46)">
              <circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/>
              <text y="38" class="label">GAIN</text>
            </g>
            <!-- Send (Echo) -->
            <g class="knob" data-role="send-delay" transform="translate(300,108)">
              <circle r="18" class="knob-face"/><line y1="-12" y2="-20" class="knob-pointer"/>
              <text y="34" class="label">SEND</text>
            </g>
            <!-- Transport buttons -->
            <g class="button" data-role="cue" transform="translate(40,108)">
              <circle r="16" class="btn-face"/>
              <circle r="20" class="led-ring led-orange"/>
              <text y="34" class="label">CUE</text>
            </g>
            <g class="button" data-role="play" transform="translate(88,108)">
              <circle r="16" class="btn-face"/>
              <circle r="20" class="led-ring led-green"/>
              <text y="34" class="label">PLAY</text>
            </g>
            <g class="button" data-role="sync" transform="translate(136,108)">
              <circle r="16" class="btn-face"/>
              <circle r="20" class="led-ring led-blue"/>
              <text y="34" class="label">SYNC</text>
            </g>
            <g class="button square" data-role="loop" transform="translate(188,96)">
              <rect x="-14" y="-14" width="28" height="28" rx="6" class="btn-face"/>
              <rect x="-18" y="-18" width="36" height="36" rx="8" class="led-frame led-cyan"/>
              <text y="34" class="label">LOOP</text>
            </g>
            <!-- Hotcues -->
            <g class="pads" transform="translate(250,92)">
              <g class="pad" data-role="hot1" transform="translate(0,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <g class="pad" data-role="hot2" transform="translate(34,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <g class="pad" data-role="hot3" transform="translate(68,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <g class="pad" data-role="hot4" transform="translate(102,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <text x="52" y="42" class="label" text-anchor="middle">HOT CUES</text>
            </g>
            <!-- Tempo fader (vertical) -->
            <g class="fader v" data-role="tempo" transform="translate(28,200)">
              <rect x="-3" y="-60" width="6" height="120" rx="3" class="track"/>
              <rect class="thumb" x="-10" y="-6" width="20" height="12" rx="3" />
              <text x="0" y="38" class="label" text-anchor="middle">TEMPO</text>
            </g>
            <!-- Meter + beats -->
            <g transform="translate(20,230)">
              <rect x="0" y="0" width="220" height="10" rx="4" class="meter-bg"/>
              <rect x="0" y="0" width="6" height="10" rx="4" class="meter-fill" data-role="meter"/>
              <g transform="translate(240,5)" class="beats">
                <circle r="5" cx="0" cy="0" class="beat-dot" data-role="beat0"/>
                <circle r="5" cx="16" cy="0" class="beat-dot" data-role="beat1"/>
                <circle r="5" cx="32" cy="0" class="beat-dot" data-role="beat2"/>
                <circle r="5" cx="48" cy="0" class="beat-dot" data-role="beat3"/>
              </g>
            </g>
          </svg>
        </div>
        <div class="row file">
          <input type="file" accept="audio/*" class="file-input" />
          <span class="track-name" title="Loaded track name">No track</span>
        </div>
        <div class="row transport">
          <button class="play">Play</button>
          <button class="sync" title="Sync tempo & phase to other deck">Sync</button>
          <button class="nudge nudge-">Nudge −</button>
          <button class="nudge nudge+">Nudge +</button>
        </div>
        <div class="row tempo">
          <label>Tempo
            <input type="range" min="-8" max="8" step="0.01" value="0" class="tempo" />
            <span class="tempo-readout">0.00%</span>
          </label>
          <label>BPM
            <input type="number" min="40" max="220" step="0.1" value="128" class="bpm" />
          </label>
          <button class="set-beat1" title="Mark beat 1 at current position">Set Beat 1</button>
        </div>
        <div class="row loop">
          <button class="loop4" title="Toggle 4-beat loop">Loop 4</button>
        </div>
        <div class="row eq">
          <label>Low
            <input type="range" min="-12" max="12" step="0.1" value="0" class="eq-low" />
          </label>
          <label>Mid
            <input type="range" min="-12" max="12" step="0.1" value="0" class="eq-mid" />
          </label>
          <label>High
            <input type="range" min="-12" max="12" step="0.1" value="0" class="eq-high" />
          </label>
        </div>
        <div class="row filter">
          <label>Filter LP ←→ HP
            <input type="range" min="-1" max="1" step="0.01" value="0" class="filter" />
          </label>
        </div>
        <div class="row gain">
          <label>Gain
            <input type="range" min="-24" max="12" step="0.1" value="0" class="gain" />
          </label>
          <label>Echo Send
            <input type="range" min="0" max="1" step="0.01" value="0" class="send-delay" />
          </label>
          <label class="cue-toggle"><input type="checkbox" class="cue-toggle-input" /> Cue</label>
        </div>
        <div class="row hotcues">
          <div class="hotcue" data-idx="0"><button class="hc-go">1</button><button class="hc-set">Set</button></div>
          <div class="hotcue" data-idx="1"><button class="hc-go">2</button><button class="hc-set">Set</button></div>
          <div class="hotcue" data-idx="2"><button class="hc-go">3</button><button class="hc-set">Set</button></div>
          <div class="hotcue" data-idx="3"><button class="hc-go">4</button><button class="hc-set">Set</button></div>
        </div>
        <div class="row keys">
          <label>Key
            <input type="text" class="key" placeholder="e.g., 8A or Am" />
          </label>
          <div class="beat-indicator">
            <span class="beat-dot" data-i="0"></span>
            <span class="beat-dot" data-i="1"></span>
            <span class="beat-dot" data-i="2"></span>
            <span class="beat-dot" data-i="3"></span>
          </div>
        </div>
        <div class="meter"><div class="bar"></div></div>
      </section>

      <section class="center">
        <div class="skin center-skin">
          <svg viewBox="0 0 320 140" class="skin-svg" aria-hidden="true">
            <!-- Crossfader -->
            <g class="fader h" data-role="crossfader" transform="translate(30,36)">
              <rect x="0" y="0" width="260" height="6" rx="3" class="track"/>
              <rect class="thumb" x="0" y="-6" width="24" height="18" rx="4" />
              <text x="130" y="24" class="label" text-anchor="middle">CROSSFADER</text>
            </g>
            <!-- Echo knobs -->
            <g transform="translate(40,90)">
              <g class="knob" data-role="echo-time" transform="translate(0,0)"><circle r="18" class="knob-face"/><line y1="-12" y2="-20" class="knob-pointer"/><text y="34" class="label">TIME</text></g>
              <g class="knob" data-role="echo-feedback" transform="translate(80,0)"><circle r="18" class="knob-face"/><line y1="-12" y2="-20" class="knob-pointer"/><text y="34" class="label">FDBK</text></g>
              <g class="knob" data-role="echo-wet" transform="translate(160,0)"><circle r="18" class="knob-face"/><line y1="-12" y2="-20" class="knob-pointer"/><text y="34" class="label">WET</text></g>
            </g>
          </svg>
        </div>
        <div class="xfader">
          <label>Crossfader
            <input id="crossfader" type="range" min="-1" max="1" step="0.01" value="0" />
          </label>
        </div>
        <div class="master">
          <label>Master Vol
            <input id="masterGain" type="range" min="-24" max="6" step="0.1" value="0" />
          </label>
          <label>Cue Mix
            <input id="cueMix" type="range" min="0" max="1" step="0.01" value="0.5" />
          </label>
          <div class="fx">
            <h3>Echo</h3>
            <label>Time
              <input id="delayTime" type="range" min="0.08" max="0.8" step="0.01" value="0.3" />
            </label>
            <label>Feedback
              <input id="delayFeedback" type="range" min="0" max="0.9" step="0.01" value="0.35" />
            </label>
            <label>Wet
              <input id="delayWet" type="range" min="0" max="1" step="0.01" value="0.2" />
            </label>
          </div>
          <div id="harmonicStatus" class="harmonic">Keys: —</div>
          <div class="meter master-meter"><div class="bar"></div></div>
        </div>
      </section>

      <section class="deck" data-deck="B">
        <h2>Deck B</h2>
        <div class="skin deck-skin" data-sdeck="B">
          <svg viewBox="0 0 360 260" class="skin-svg" aria-hidden="true">
            <!-- EQ knobs -->
            <g class="knob" data-role="eq-low" transform="translate(60,46)"><circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/><text y="38" class="label">LOW</text></g>
            <g class="knob" data-role="eq-mid" transform="translate(120,46)"><circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/><text y="38" class="label">MID</text></g>
            <g class="knob" data-role="eq-high" transform="translate(180,46)"><circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/><text y="38" class="label">HI</text></g>
            <g class="knob" data-role="filter" transform="translate(240,46)"><circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/><text y="38" class="label">FILTER</text></g>
            <g class="knob" data-role="gain" transform="translate(300,46)"><circle r="22" class="knob-face"/><line y1="-14" y2="-22" class="knob-pointer"/><text y="38" class="label">GAIN</text></g>
            <g class="knob" data-role="send-delay" transform="translate(300,108)"><circle r="18" class="knob-face"/><line y1="-12" y2="-20" class="knob-pointer"/><text y="34" class="label">SEND</text></g>
            <!-- Transport -->
            <g class="button" data-role="cue" transform="translate(40,108)"><circle r="16" class="btn-face"/><circle r="20" class="led-ring led-orange"/><text y="34" class="label">CUE</text></g>
            <g class="button" data-role="play" transform="translate(88,108)"><circle r="16" class="btn-face"/><circle r="20" class="led-ring led-green"/><text y="34" class="label">PLAY</text></g>
            <g class="button" data-role="sync" transform="translate(136,108)"><circle r="16" class="btn-face"/><circle r="20" class="led-ring led-blue"/><text y="34" class="label">SYNC</text></g>
            <g class="button square" data-role="loop" transform="translate(188,96)"><rect x="-14" y="-14" width="28" height="28" rx="6" class="btn-face"/><rect x="-18" y="-18" width="36" height="36" rx="8" class="led-frame led-cyan"/><text y="34" class="label">LOOP</text></g>
            <!-- Pads -->
            <g class="pads" transform="translate(250,92)">
              <g class="pad" data-role="hot1" transform="translate(0,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <g class="pad" data-role="hot2" transform="translate(34,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <g class="pad" data-role="hot3" transform="translate(68,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <g class="pad" data-role="hot4" transform="translate(102,0)"><rect x="-12" y="-12" width="24" height="24" rx="5" class="pad-face"/><rect x="-15" y="-15" width="30" height="30" rx="7" class="led-frame led-amber"/></g>
              <text x="52" y="42" class="label" text-anchor="middle">HOT CUES</text>
            </g>
            <!-- Tempo fader -->
            <g class="fader v" data-role="tempo" transform="translate(28,200)">
              <rect x="-3" y="-60" width="6" height="120" rx="3" class="track"/>
              <rect class="thumb" x="-10" y="-6" width="20" height="12" rx="3" />
              <text x="0" y="38" class="label" text-anchor="middle">TEMPO</text>
            </g>
            <!-- Meter + beats -->
            <g transform="translate(20,230)">
              <rect x="0" y="0" width="220" height="10" rx="4" class="meter-bg"/>
              <rect x="0" y="0" width="6" height="10" rx="4" class="meter-fill" data-role="meter"/>
              <g transform="translate(240,5)" class="beats">
                <circle r="5" cx="0" cy="0" class="beat-dot" data-role="beat0"/>
                <circle r="5" cx="16" cy="0" class="beat-dot" data-role="beat1"/>
                <circle r="5" cx="32" cy="0" class="beat-dot" data-role="beat2"/>
                <circle r="5" cx="48" cy="0" class="beat-dot" data-role="beat3"/>
              </g>
            </g>
          </svg>
        </div>
        <div class="row file">
          <input type="file" accept="audio/*" class="file-input" />
          <span class="track-name" title="Loaded track name">No track</span>
        </div>
        <div class="row transport">
          <button class="play">Play</button>
          <button class="sync" title="Sync tempo & phase to other deck">Sync</button>
          <button class="nudge nudge-">Nudge −</button>
          <button class="nudge nudge+">Nudge +</button>
        </div>
        <div class="row tempo">
          <label>Tempo
            <input type="range" min="-8" max="8" step="0.01" value="0" class="tempo" />
            <span class="tempo-readout">0.00%</span>
          </label>
          <label>BPM
            <input type="number" min="40" max="220" step="0.1" value="128" class="bpm" />
          </label>
          <button class="set-beat1" title="Mark beat 1 at current position">Set Beat 1</button>
        </div>
        <div class="row loop">
          <button class="loop4" title="Toggle 4-beat loop">Loop 4</button>
        </div>
        <div class="row eq">
          <label>Low
            <input type="range" min="-12" max="12" step="0.1" value="0" class="eq-low" />
          </label>
          <label>Mid
            <input type="range" min="-12" max="12" step="0.1" value="0" class="eq-mid" />
          </label>
          <label>High
            <input type="range" min="-12" max="12" step="0.1" value="0" class="eq-high" />
          </label>
        </div>
        <div class="row filter">
          <label>Filter LP ←→ HP
            <input type="range" min="-1" max="1" step="0.01" value="0" class="filter" />
          </label>
        </div>
        <div class="row gain">
          <label>Gain
            <input type="range" min="-24" max="12" step="0.1" value="0" class="gain" />
          </label>
          <label>Echo Send
            <input type="range" min="0" max="1" step="0.01" value="0" class="send-delay" />
          </label>
          <label class="cue-toggle"><input type="checkbox" class="cue-toggle-input" /> Cue</label>
        </div>
        <div class="row hotcues">
          <div class="hotcue" data-idx="0"><button class="hc-go">1</button><button class="hc-set">Set</button></div>
          <div class="hotcue" data-idx="1"><button class="hc-go">2</button><button class="hc-set">Set</button></div>
          <div class="hotcue" data-idx="2"><button class="hc-go">3</button><button class="hc-set">Set</button></div>
          <div class="hotcue" data-idx="3"><button class="hc-go">4</button><button class="hc-set">Set</button></div>
        </div>
        <div class="row keys">
          <label>Key
            <input type="text" class="key" placeholder="e.g., 9A or C" />
          </label>
          <div class="beat-indicator">
            <span class="beat-dot" data-i="0"></span>
            <span class="beat-dot" data-i="1"></span>
            <span class="beat-dot" data-i="2"></span>
            <span class="beat-dot" data-i="3"></span>
          </div>
        </div>
        <div class="meter"><div class="bar"></div></div>
      </section>
    </main>

    <!-- Tutorial overlay -->
    <div id="coach" class="coach hidden">
      <div class="coach-dim"></div>
      <div class="coach-spotlight"></div>
      <div class="coach-card">
        <div class="coach-title"></div>
        <div class="coach-body"></div>
        <div class="coach-ctrls">
          <button class="coach-prev">Back</button>
          <div class="coach-progress"></div>
          <button class="coach-next">Next</button>
          <button class="coach-skip" title="Exit tutorial">Skip</button>
        </div>
      </div>
    </div>

    <div id="help" class="help hidden">
      <div class="help-inner">
        <h2>Top 10 DJ Techniques (Controls Included)</h2>
        <ol>
          <li>Beatmatching — Tempo slider, Sync, Nudge</li>
          <li>Phrasing — Set Beat 1, 1–4 beat dots</li>
          <li>EQing — Low/Mid/High ±12 dB</li>
          <li>Gain staging — Deck Gain + meters</li>
          <li>Crossfading — Constant‑power crossfader</li>
          <li>Looping — 4‑beat loop toggle</li>
          <li>Hot Cues — 1–4 set/trigger</li>
          <li>Filtering — Single knob LP↔HP</li>
          <li>Effects — Echo send + time/feedback/wet</li>
          <li>Harmonic mixing — Key fields + compatibility hint</li>
        </ol>
        <h3>Keyboard Shortcuts</h3>
        <ul>
          <li>Alt+1 / Alt+2 — Focus Deck A/B</li>
          <li>Space — Play/Pause (focused deck)</li>
          <li>Alt+S — Sync to other deck</li>
          <li>Alt+L — Toggle Loop 4 • Alt+B — Set Beat 1</li>
          <li>Alt+Digit1..4 — Hot Cue 1..4 • Add Shift to Set</li>
          <li>Alt+ArrowUp/Down — Tempo ±0.25% • +Shift for ±1%</li>
          <li>Alt+Comma/Period — Filter LP/HP sweep</li>
          <li>Alt+BracketLeft/Right — Crossfader L/R</li>
          <li>Alt+C — Toggle Cue • Alt+E/Alt+Shift+E — Echo send ±</li>
          <li>Alt+/ — Help • Alt+T — Tutorial • Alt+V — Visual Mode</li>
        </ul>
        <label style="display:flex;gap:8px;align-items:center;margin:8px 0;">
          <input id="singleKeyToggle" type="checkbox" /> Enable single‑key shortcuts (not recommended; use with care)
        </label>
        <p>Tip: click “Start Audio” first (required by browsers).</p>
        <button id="closeHelp">Close</button>
      </div>
    </div>

    <script type="module" src="src/main.js"></script>
  </body>
  </html>
